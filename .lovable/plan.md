

# Админ-панель для управления страницами объектов

## Что будет сделано

Полноценная админ-панель, через которую можно создавать и редактировать страницы объектов недвижимости. Каждая страница собирается из блоков-секций (как конструктор): можно включать/выключать блоки, менять их порядок перетаскиванием, редактировать контент через формы с визуальным предпросмотром.

## Как это будет работать

1. **Авторизация** -- страница `/admin/login` с логином и паролем (через Supabase Auth)
2. **Список объектов** -- `/admin` показывает таблицу всех созданных страниц с кнопками "Редактировать", "Копировать", "Создать новый"
3. **Редактор объекта** -- `/admin/pages/:id` с двумя колонками:
   - Слева: панель блоков (тоглы вкл/выкл + drag-and-drop для порядка) и формы редактирования активного блока
   - Справа: живой предпросмотр страницы
4. **Публичная часть** -- главная `/` станет каталогом объектов, каждый объект по адресу `/objects/:slug`

## Блоки, доступные для управления

Каждый блок соответствует текущему компоненту:

| Блок | Редактируемые поля |
|---|---|
| PropertyHero | Заголовок, подзаголовки, рейтинг |
| PropertyStats | 4 показателя (название + значение) |
| PhotoGallery | Загрузка фото (до 10), подписи |
| PropertyDetails | Текстовые блоки, карточки, цена пая, кнопки |
| LocationSection | Адрес, координаты карты, маркеры списка, карточки преимуществ с фото |
| FinancialSection | Заголовки табов, описания, данные графика, кнопки |
| SimilarProperties | Заголовок (объекты подтягиваются автоматически) |
| FAQSection | Заголовок, описание, вопросы-ответы (добавлять/удалять) |
| ContactForm | Заголовки, контакты |

## Техническая архитектура

### База данных (Lovable Cloud / Supabase)

```text
pages
  id, slug, title, status (draft/published), created_at, updated_at

page_blocks
  id, page_id (FK), block_type, sort_order, enabled, content (JSONB)

Supabase Storage
  bucket: "page-images" -- фотографии объектов
```

Поле `content` (JSONB) хранит все данные блока -- тексты, числа, ссылки на фото в Storage. Структура JSON зависит от `block_type`.

### Маршруты

```text
/                     -- каталог объектов (публичный)
/objects/:slug        -- страница объекта (публичный)
/admin/login          -- авторизация
/admin                -- список страниц (защищенный)
/admin/pages/:id      -- редактор страницы (защищенный)
```

### Ключевые компоненты

- `AdminLayout` -- обертка с сайдбаром и проверкой авторизации
- `PagesList` -- таблица страниц с действиями
- `PageEditor` -- основной редактор с панелью блоков
- `BlockPanel` -- список блоков с тоглами и drag-and-drop
- `BlockEditor` -- формы для каждого типа блока (условный рендер по `block_type`)
- `PagePreview` -- предпросмотр собранной страницы
- `PropertyPage` -- публичная страница, загружает данные из БД и рендерит блоки

### Визуальный редактор

Левая панель:
- Список блоков с переключателями (Switch) и перетаскиванием
- Клик по блоку открывает форму редактирования
- Формы с полями: текстовые инпуты, текстареа, загрузка фото, числовые поля

Правая панель:
- Iframe или inline-рендер страницы с текущими данными
- Обновляется при сохранении блока

### Авторизация

- Supabase Auth (email + пароль)
- Один аккаунт администратора (создается вручную)
- RLS-политики: чтение `pages` и `page_blocks` для всех (published), запись только для авторизованного пользователя

## Порядок реализации

1. Подключение Lovable Cloud (Supabase)
2. Создание таблиц и Storage bucket
3. Авторизация (логин-страница, защита маршрутов)
4. Список страниц (CRUD)
5. Редактор: панель блоков (тоглы + drag-and-drop порядок)
6. Редактор: формы для каждого типа блока
7. Предпросмотр страницы в редакторе
8. Публичная страница объекта (загрузка из БД)
9. Каталог объектов на главной
10. Копирование страниц

